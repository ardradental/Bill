<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ardra Dental Clinic - Billing System</title>
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .loader {
            border: 5px solid #f3f4f6;
            border-top: 5px solid #7c3aed;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .premium-heading {
            font-family: 'Playfair Display', serif;
            letter-spacing: 2px;
        }
        .premium-tagline {
            font-family: 'Cormorant Garamond', serif;
            font-style: italic;
            letter-spacing: 1px;
        }
        .premium-body {
            font-family: 'Poppins', sans-serif;
        }
        .content-layer {
            position: relative;
            z-index: 1;
        }
        @media print {
            body {
                background: white;
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
            @page {
                margin: 1cm;
                size: A4;
            }
            input, textarea, select {
                border: none !important;
                background: transparent !important;
            }
            button {
                display: none !important;
            }
            .no-print {
                display: none !important;
            }
            .print-border {
                border: 1px solid #e5e7eb !important;
            }
            .page-break-avoid {
                page-break-inside: avoid;
                break-inside: avoid;
            }
            .premium-card {
                box-shadow: none !important;
                border: 1px solid #e5e7eb !important;
            }
        }
        .premium-card {
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .premium-border {
            border: 2px solid;
            border-image: linear-gradient(45deg, #7c3aed, #a78bfa) 1;
        }
    </style>
</head>
<body class="premium-body">
    <div id="loading">
        <div class="loader"></div>
    </div>
    <div id="root"></div>
    
    <script type="text/babel">
        window.addEventListener('load', () => {
            setTimeout(() => {
                const loading = document.getElementById('loading');
                if (loading) loading.style.display = 'none';
            }, 500);
        });

        const { useState, useEffect } = React;

        const Icon = ({ name, className = "w-5 h-5" }) => {
            const icons = {
                printer: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" /></svg>,
                plus: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>,
                trash: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
                calendar: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
                save: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" /></svg>,
                mail: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>,
                edit: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>,
                check: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>,
                x: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
                phone: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
            };
            return icons[name] || null;
        };

        function DentalBillingSystem() {
            const [invoiceDate, setInvoiceDate] = useState(new Date().toISOString().split('T')[0]);
            const [invoiceNumber, setInvoiceNumber] = useState('');
            const [patientName, setPatientName] = useState('');
            const [patientAge, setPatientAge] = useState('');
            const [patientPhone, setPatientPhone] = useState('');
            const [patientLocation, setPatientLocation] = useState('');
            const [clinicalAssessment, setClinicalAssessment] = useState('');
            const [doctorName, setDoctorName] = useState('');
            const [treatments, setTreatments] = useState([]);
            const [currentTreatment, setCurrentTreatment] = useState('');
            const [customDescription, setCustomDescription] = useState('');
            const [treatmentPlan, setTreatmentPlan] = useState('');
            const [currentPrice, setCurrentPrice] = useState('');
            const [discount, setDiscount] = useState('0');
            const [tax, setTax] = useState('18');
            const [paymentType, setPaymentType] = useState('');
            const [emiMonths, setEmiMonths] = useState('');
            const [emiAmount, setEmiAmount] = useState('');
            const [downPayment, setDownPayment] = useState('');
            const [emiPaymentType, setEmiPaymentType] = useState('');
            const [editingTreatment, setEditingTreatment] = useState(null);
            const [editValues, setEditValues] = useState({ name: '', price: '', plan: '' });
            const [saveStatus, setSaveStatus] = useState('');
            const [showCustomInput, setShowCustomInput] = useState(false);

            const commonTreatments = [
                'Root Canal Treatment', 'Teeth Cleaning/Scaling', 'Tooth Extraction', 'Dental Filling',
                'Crown/Cap', 'Bridge', 'Dental Implant', 'Teeth Whitening', 'Orthodontic Braces',
                'Dentures', 'Wisdom Tooth Removal', 'Gum Treatment', 'Veneer', 'Consultation Fee',
                'Custom - Describe Service'
            ];

            useEffect(() => {
                const date = new Date(invoiceDate);
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const invoiceCount = Math.floor(Math.random() * 1000) + 1;
                setInvoiceNumber(`ADC-${year}-${month}-${String(invoiceCount).padStart(4, '0')}`);
            }, [invoiceDate]);

            const handleTreatmentSelect = (value) => {
                if (value === 'Custom - Describe Service') {
                    setShowCustomInput(true);
                    setCurrentTreatment('');
                } else {
                    setShowCustomInput(false);
                    setCurrentTreatment(value);
                    setCustomDescription('');
                }
            };

            const addTreatment = () => {
                const treatmentName = showCustomInput ? customDescription : currentTreatment;
                if (treatmentName && currentPrice) {
                    setTreatments([...treatments, {
                        id: Date.now(),
                        name: treatmentName,
                        price: parseFloat(currentPrice),
                        plan: treatmentPlan
                    }]);
                    setCurrentTreatment('');
                    setCustomDescription('');
                    setTreatmentPlan('');
                    setCurrentPrice('');
                    setShowCustomInput(false);
                }
            };

            const startEdit = (treatment) => {
                setEditingTreatment(treatment.id);
                setEditValues({ name: treatment.name, price: treatment.price.toString(), plan: treatment.plan || '' });
            };

            const saveEdit = (id) => {
                if (editValues.name && editValues.price) {
                    setTreatments(treatments.map(t => 
                        t.id === id ? { ...t, name: editValues.name, price: parseFloat(editValues.price), plan: editValues.plan } : t
                    ));
                    setEditingTreatment(null);
                }
            };

            const cancelEdit = () => {
                setEditingTreatment(null);
                setEditValues({ name: '', price: '', plan: '' });
            };

            const removeTreatment = (id) => {
                setTreatments(treatments.filter(t => t.id !== id));
            };

            const calculateSubtotal = () => {
                return treatments.reduce((sum, treatment) => sum + treatment.price, 0);
            };

            const calculateDiscount = () => {
                return (calculateSubtotal() * parseFloat(discount || 0)) / 100;
            };

            const calculateTax = () => {
                const afterDiscount = calculateSubtotal() - calculateDiscount();
                return (afterDiscount * parseFloat(tax || 0)) / 100;
            };

            const calculateTotal = () => {
                return calculateSubtotal() - calculateDiscount() + calculateTax();
            };

            const handlePrint = () => {
                window.print();
            };

            const handleSave = async () => {
                setSaveStatus('saving');
                
                const invoiceData = {
                    invoiceNumber, invoiceDate, patientName, patientAge, patientPhone, patientLocation,
                    clinicalAssessment, doctorName, treatments,
                    subtotal: calculateSubtotal(),
                    discount: calculateDiscount(),
                    tax: calculateTax(),
                    total: calculateTotal(),
                    paymentType,
                    emiDetails: paymentType === 'EMI' ? {
                        months: emiMonths,
                        monthlyAmount: emiAmount,
                        downPayment,
                        paymentType: emiPaymentType
                    } : null
                };

                const dataStr = JSON.stringify(invoiceData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `Invoice_${invoiceNumber}_${patientName.replace(/\s+/g, '_')}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                setTimeout(() => {
                    setSaveStatus('saved');
                    setTimeout(() => setSaveStatus(''), 2000);
                }, 1000);
            };

            const handleSendEmail = async () => {
                setSaveStatus('sending');
                
                const emailBody = `Invoice Details:
--------------
Invoice Number: ${invoiceNumber}
Date: ${invoiceDate}
Patient Name: ${patientName}
Age: ${patientAge}
Phone: ${patientPhone}
Location: ${patientLocation}

Clinical Assessment: ${clinicalAssessment}

Doctor: ${doctorName}

Treatments:
${treatments.map(t => `- ${t.name}: ₹${t.price}`).join('\n')}

Subtotal: ₹${calculateSubtotal().toFixed(2)}
Discount: ₹${calculateDiscount().toFixed(2)}
Tax: ₹${calculateTax().toFixed(2)}
Total: ₹${calculateTotal().toFixed(2)}

Payment Type: ${paymentType}
${paymentType === 'EMI' ? `EMI Details:
- Months: ${emiMonths}
- Monthly Amount: ₹${emiAmount}
- Down Payment: ₹${downPayment}
- Payment Type: ${emiPaymentType}` : ''}`;

                const mailtoLink = `mailto:ardradentalclinic@gmail.com?subject=Invoice ${invoiceNumber} - ${patientName}&body=${encodeURIComponent(emailBody)}`;
                window.location.href = mailtoLink;

                setTimeout(() => {
                    setSaveStatus('sent');
                    setTimeout(() => setSaveStatus(''), 3000);
                }, 1500);
            };

            const clearForm = () => {
                setPatientName(''); setPatientAge(''); setPatientPhone(''); setPatientLocation('');
                setClinicalAssessment(''); setDoctorName(''); setTreatments([]);
                setCurrentTreatment(''); setCustomDescription(''); setTreatmentPlan(''); setCurrentPrice('');
                setDiscount('0'); setTax('18'); setPaymentType(''); setEmiMonths(''); setEmiAmount('');
                setDownPayment(''); setEmiPaymentType(''); setShowCustomInput(false);
                setInvoiceDate(new Date().toISOString().split('T')[0]);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 p-4 md:p-8">
                    <div className="max-w-5xl mx-auto content-layer">
